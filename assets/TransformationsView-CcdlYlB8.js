import{u as ue,r as d,o as se,c as C,a as V,b as t,d as u,w as a,e as c,f as s,t as q,k as de,h as _,g as G,F as me,i as pe}from"./index-DvHs-uuO.js";const fe={class:"d-flex align-center mb-4"},ce={key:0},ve={key:1},ge={key:2},ye={key:3},_e={__name:"TransformationsView",setup(Ce){const B=ue(),Z=[{title:"Name",key:"name"},{title:"Type",key:"type",width:"120px"},{title:"Description",key:"description"},{title:"Created",key:"createdAt",width:"150px"},{title:"Actions",key:"actions",sortable:!1,width:"120px",align:"end"}],x=d(""),S=d("All"),E=d("name_asc"),H=d([{title:"All Types",value:"All"},{title:"Filter",value:"Filter"},{title:"Map",value:"Map"},{title:"Aggregation",value:"Aggregation"},{title:"Script",value:"Script"}]),W=d([{title:"Name (A-Z)",value:"name_asc"},{title:"Name (Z-A)",value:"name_desc"},{title:"Type",value:"type_asc"},{title:"Created (Newest)",value:"created_desc"},{title:"Created (Oldest)",value:"created_asc"}]),j=["Filter","Map","Aggregation","Script"],v=d([]),F=d(!1),M=d(!1),O=d(!1),g=d(!1),w=d(!1),k=d(null),K=d(null),o=d(X()),A=["id","firstName","lastName","email","phone","address","city","state","zipCode","country","age","income","purchaseAmount","orderDate","productCategory"];function X(){return{id:null,name:"",type:"Filter",description:"",config:{filterColumn:"",operator:"equals",value:"",sourceColumn:"",targetColumn:"",mappings:[],groupByColumns:[],aggregationType:"sum",aggregationColumn:"",resultColumn:"",script:""}}}function Q(n){switch(n){case"Filter":return"info";case"Map":return"success";case"Aggregation":return"warning";case"Script":return"deep-purple";default:return"grey"}}function Y(n){return n?new Date(n).toLocaleString():"-"}async function b(){try{F.value=!0,await new Promise(r=>setTimeout(r,500));let e=[...[{id:"1",name:"Filter Inactive Customers",type:"Filter",description:"Removes inactive customers from the dataset",createdAt:new Date(Date.now()-30*24*60*60*1e3).toISOString(),config:{filterColumn:"isActive",operator:"equals",value:"true"}},{id:"2",name:"Map Customer Segments",type:"Map",description:"Maps numeric customer segments to readable names",createdAt:new Date(Date.now()-25*24*60*60*1e3).toISOString(),config:{sourceColumn:"segmentId",targetColumn:"segmentName",mappings:[{from:"1",to:"High Value"},{from:"2",to:"Medium Value"},{from:"3",to:"Low Value"}]}},{id:"3",name:"Sales by Region Aggregation",type:"Aggregation",description:"Aggregates sales data by region",createdAt:new Date(Date.now()-20*24*60*60*1e3).toISOString(),config:{groupByColumns:["region","country"],aggregationType:"sum",aggregationColumn:"salesAmount",resultColumn:"totalSales"}},{id:"4",name:"Format Phone Numbers",type:"Script",description:"Formats phone numbers to a consistent pattern",createdAt:new Date(Date.now()-15*24*60*60*1e3).toISOString(),config:{script:`
// Format phone numbers to (XXX) XXX-XXXX
data.forEach(row => {
  if (row.phone) {
    // Remove any non-digit characters
    let digits = row.phone.replace(/\\D/g, '');
    
    // Check if we have enough digits for a US phone number
    if (digits.length === 10) {
      row.phone = \`(\${digits.substring(0, 3)}) \${digits.substring(3, 6)}-\${digits.substring(6)}\`;
    }
  }
});

return data;
          `}},{id:"5",name:"Remove Duplicate Orders",type:"Filter",description:"Removes duplicate orders based on order ID",createdAt:new Date(Date.now()-10*24*60*60*1e3).toISOString(),config:{filterColumn:"isDuplicate",operator:"equals",value:"false"}}]];if(x.value){const r=x.value.toLowerCase();e=e.filter(i=>i.name.toLowerCase().includes(r)||i.description.toLowerCase().includes(r))}S.value!=="All"&&(e=e.filter(r=>r.type===S.value));const[y,p]=E.value.split("_");e.sort((r,i)=>{let m=r[y],f=i[y];return y==="created"&&(m=new Date(r.createdAt).getTime(),f=new Date(i.createdAt).getTime()),p==="asc"?m>f?1:-1:m<f?1:-1}),v.value=e}catch(n){console.error("Error fetching transformations:",n)}finally{F.value=!1}}function h(n){o.value=JSON.parse(JSON.stringify(n)),g.value=!0}function ee(n){const e=JSON.parse(JSON.stringify(n));e.id=null,e.name=`Copy of ${e.name}`,o.value=e,g.value=!0}function te(){o.value.config.mappings||(o.value.config.mappings=[]),o.value.config.mappings.push({from:"",to:""})}function le(n){o.value.config.mappings.splice(n,1)}function ae(n){k.value=n,w.value=!0}async function oe(){try{O.value=!0,await new Promise(e=>setTimeout(e,1e3));const n=v.value.findIndex(e=>e.id===k.value.id);n!==-1&&v.value.splice(n,1),w.value=!1,k.value=null}catch(n){console.error("Error deleting transformation:",n)}finally{O.value=!1}}async function L(){try{M.value=!0,await new Promise(e=>setTimeout(e,1e3)),o.value.id||(o.value.id=Math.random().toString(36).substring(2,15),o.value.createdAt=new Date().toISOString());const n=v.value.findIndex(e=>e.id===o.value.id);n!==-1?v.value[n]={...o.value}:v.value.push({...o.value}),g.value=!1,o.value=X()}catch(n){console.error("Error saving transformation:",n)}finally{M.value=!1}}return se(()=>{b(),B.$subscribe(()=>{B.currentTenantId&&b()})}),(n,e)=>{const y=u("v-spacer"),p=u("v-btn"),r=u("v-text-field"),i=u("v-col"),m=u("v-select"),f=u("v-row"),ne=u("v-chip"),D=u("v-icon"),ie=u("v-data-table"),I=u("v-card-text"),$=u("v-card"),z=u("v-card-title"),R=u("v-textarea"),N=u("v-divider"),re=u("v-form"),J=u("v-card-actions"),P=u("v-dialog");return c(),C("div",null,[V("div",fe,[e[22]||(e[22]=V("h1",{class:"text-h4 mr-4"},"Transformations",-1)),t(y),t(p,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=l=>g.value=!0)},{default:a(()=>e[21]||(e[21]=[s(" Create Transformation ")])),_:1})]),t($,null,{default:a(()=>[t(I,null,{default:a(()=>[t(f,null,{default:a(()=>[t(i,{cols:"12",md:"4"},{default:a(()=>[t(r,{modelValue:x.value,"onUpdate:modelValue":[e[1]||(e[1]=l=>x.value=l),b],label:"Search Transformations","prepend-inner-icon":"mdi-magnify",density:"compact","hide-details":"",class:"mb-4"},null,8,["modelValue"])]),_:1}),t(i,{cols:"12",md:"3"},{default:a(()=>[t(m,{modelValue:S.value,"onUpdate:modelValue":[e[2]||(e[2]=l=>S.value=l),b],label:"Type",items:H.value,density:"compact","hide-details":"",class:"mb-4"},null,8,["modelValue","items"])]),_:1}),t(i,{cols:"12",md:"3"},{default:a(()=>[t(m,{modelValue:E.value,"onUpdate:modelValue":[e[3]||(e[3]=l=>E.value=l),b],label:"Sort By",items:W.value,density:"compact","hide-details":"",class:"mb-4"},null,8,["modelValue","items"])]),_:1})]),_:1}),t(ie,{headers:Z,items:v.value,loading:F.value,"items-per-page":10,class:"mt-2"},{"item.type":a(({item:l})=>[t(ne,{color:Q(l.type),"text-color":"white",size:"small"},{default:a(()=>[s(q(l.type),1)]),_:2},1032,["color"])]),"item.createdAt":a(({item:l})=>[s(q(Y(l.createdAt)),1)]),"item.actions":a(({item:l})=>[t(p,{icon:"",variant:"text",size:"small",onClick:T=>h(l),title:"Edit transformation"},{default:a(()=>[t(D,null,{default:a(()=>e[23]||(e[23]=[s("mdi-pencil")])),_:1})]),_:2},1032,["onClick"]),t(p,{icon:"",variant:"text",size:"small",onClick:T=>ee(l),title:"Clone transformation"},{default:a(()=>[t(D,null,{default:a(()=>e[24]||(e[24]=[s("mdi-content-copy")])),_:1})]),_:2},1032,["onClick"]),t(p,{icon:"",variant:"text",size:"small",color:"error",onClick:T=>ae(l),title:"Delete transformation"},{default:a(()=>[t(D,null,{default:a(()=>e[25]||(e[25]=[s("mdi-delete")])),_:1})]),_:2},1032,["onClick"])]),_:1},8,["items","loading"])]),_:1})]),_:1}),t(P,{modelValue:g.value,"onUpdate:modelValue":e[18]||(e[18]=l=>g.value=l),"max-width":"800px",persistent:""},{default:a(()=>[t($,null,{default:a(()=>[t(z,null,{default:a(()=>[s(q(o.value.id?"Edit Transformation":"Create Transformation"),1)]),_:1}),t(I,null,{default:a(()=>[t(re,{ref_key:"form",ref:K,onSubmit:de(L,["prevent"])},{default:a(()=>[t(f,null,{default:a(()=>[t(i,{cols:"12",md:"8"},{default:a(()=>[t(r,{modelValue:o.value.name,"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.name=l),label:"Transformation Name",required:"",rules:[l=>!!l||"Name is required"]},null,8,["modelValue","rules"])]),_:1}),t(i,{cols:"12",md:"4"},{default:a(()=>[t(m,{modelValue:o.value.type,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.type=l),label:"Type",items:j,required:"",rules:[l=>!!l||"Type is required"]},null,8,["modelValue","rules"])]),_:1}),t(i,{cols:"12"},{default:a(()=>[t(R,{modelValue:o.value.description,"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.description=l),label:"Description",rows:"2"},null,8,["modelValue"])]),_:1})]),_:1}),o.value.type==="Filter"?(c(),C("div",ce,[t(N,{class:"my-4"}),e[26]||(e[26]=V("h3",{class:"text-subtitle-1 mb-3"},"Filter Configuration",-1)),t(f,null,{default:a(()=>[t(i,{cols:"12",md:"6"},{default:a(()=>[t(m,{modelValue:o.value.config.filterColumn,"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.config.filterColumn=l),label:"Column to Filter",items:A,required:""},null,8,["modelValue"])]),_:1}),t(i,{cols:"12",md:"6"},{default:a(()=>[t(m,{modelValue:o.value.config.operator,"onUpdate:modelValue":e[8]||(e[8]=l=>o.value.config.operator=l),label:"Operator",items:[{title:"Equals",value:"equals"},{title:"Not Equals",value:"notEquals"},{title:"Greater Than",value:"greaterThan"},{title:"Less Than",value:"lessThan"},{title:"Contains",value:"contains"},{title:"Not Contains",value:"notContains"},{title:"Is Empty",value:"isEmpty"},{title:"Is Not Empty",value:"isNotEmpty"}],required:""},null,8,["modelValue"])]),_:1}),["isEmpty","isNotEmpty"].includes(o.value.config.operator)?_("",!0):(c(),G(i,{key:0,cols:"12"},{default:a(()=>[t(r,{modelValue:o.value.config.value,"onUpdate:modelValue":e[9]||(e[9]=l=>o.value.config.value=l),label:"Value",required:""},null,8,["modelValue"])]),_:1}))]),_:1})])):_("",!0),o.value.type==="Map"?(c(),C("div",ve,[t(N,{class:"my-4"}),e[29]||(e[29]=V("h3",{class:"text-subtitle-1 mb-3"},"Mapping Configuration",-1)),t(f,null,{default:a(()=>[t(i,{cols:"12",md:"6"},{default:a(()=>[t(m,{modelValue:o.value.config.sourceColumn,"onUpdate:modelValue":e[10]||(e[10]=l=>o.value.config.sourceColumn=l),label:"Source Column",items:A,required:""},null,8,["modelValue"])]),_:1}),t(i,{cols:"12",md:"6"},{default:a(()=>[t(r,{modelValue:o.value.config.targetColumn,"onUpdate:modelValue":e[11]||(e[11]=l=>o.value.config.targetColumn=l),label:"Target Column (leave empty to overwrite source)"},null,8,["modelValue"])]),_:1})]),_:1}),(c(!0),C(me,null,pe(o.value.config.mappings,(l,T)=>(c(),C("div",{key:T,class:"d-flex align-center mb-2"},[t(r,{modelValue:l.from,"onUpdate:modelValue":U=>l.from=U,label:"From Value",density:"compact",class:"mr-2"},null,8,["modelValue","onUpdate:modelValue"]),t(r,{modelValue:l.to,"onUpdate:modelValue":U=>l.to=U,label:"To Value",density:"compact",class:"mr-2"},null,8,["modelValue","onUpdate:modelValue"]),t(p,{icon:"",variant:"text",color:"error",size:"small",onClick:U=>le(T)},{default:a(()=>[t(D,null,{default:a(()=>e[27]||(e[27]=[s("mdi-delete")])),_:1})]),_:2},1032,["onClick"])]))),128)),t(p,{"prepend-icon":"mdi-plus",variant:"text",onClick:te,size:"small",class:"mt-2"},{default:a(()=>e[28]||(e[28]=[s(" Add Mapping ")])),_:1})])):_("",!0),o.value.type==="Aggregation"?(c(),C("div",ge,[t(N,{class:"my-4"}),e[30]||(e[30]=V("h3",{class:"text-subtitle-1 mb-3"},"Aggregation Configuration",-1)),t(f,null,{default:a(()=>[t(i,{cols:"12",md:"6"},{default:a(()=>[t(m,{modelValue:o.value.config.groupByColumns,"onUpdate:modelValue":e[12]||(e[12]=l=>o.value.config.groupByColumns=l),label:"Group By Columns",items:A,multiple:"",chips:"",required:""},null,8,["modelValue"])]),_:1}),t(i,{cols:"12",md:"6"},{default:a(()=>[t(m,{modelValue:o.value.config.aggregationType,"onUpdate:modelValue":e[13]||(e[13]=l=>o.value.config.aggregationType=l),label:"Aggregation Type",items:[{title:"Sum",value:"sum"},{title:"Average",value:"avg"},{title:"Count",value:"count"},{title:"Min",value:"min"},{title:"Max",value:"max"}],required:""},null,8,["modelValue"])]),_:1}),o.value.config.aggregationType!=="count"?(c(),G(i,{key:0,cols:"12",md:"6"},{default:a(()=>[t(m,{modelValue:o.value.config.aggregationColumn,"onUpdate:modelValue":e[14]||(e[14]=l=>o.value.config.aggregationColumn=l),label:"Aggregation Column",items:A,required:""},null,8,["modelValue"])]),_:1})):_("",!0),t(i,{cols:"12",md:"6"},{default:a(()=>[t(r,{modelValue:o.value.config.resultColumn,"onUpdate:modelValue":e[15]||(e[15]=l=>o.value.config.resultColumn=l),label:"Result Column Name",required:""},null,8,["modelValue"])]),_:1})]),_:1})])):_("",!0),o.value.type==="Script"?(c(),C("div",ye,[t(N,{class:"my-4"}),e[31]||(e[31]=V("h3",{class:"text-subtitle-1 mb-3"},"Script Configuration",-1)),t(R,{modelValue:o.value.config.script,"onUpdate:modelValue":e[16]||(e[16]=l=>o.value.config.script=l),label:"Script (JS/C#)",rows:"10",class:"font-family-monospace",placeholder:`// Write your transformation script here
// Example:
// data.forEach(row => {
//   row.fullName = row.firstName + ' ' + row.lastName;
// });
// return data;`},null,8,["modelValue"])])):_("",!0)]),_:1},512)]),_:1}),t(J,null,{default:a(()=>[t(y),t(p,{variant:"text",onClick:e[17]||(e[17]=l=>g.value=!1)},{default:a(()=>e[32]||(e[32]=[s(" Cancel ")])),_:1}),t(p,{color:"primary",onClick:L,loading:M.value},{default:a(()=>e[33]||(e[33]=[s(" Save ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(P,{modelValue:w.value,"onUpdate:modelValue":e[20]||(e[20]=l=>w.value=l),"max-width":"400px"},{default:a(()=>[t($,null,{default:a(()=>[t(z,{class:"text-h5"},{default:a(()=>e[34]||(e[34]=[s(" Delete Transformation ")])),_:1}),t(I,null,{default:a(()=>{var l;return[s(' Are you sure you want to delete the transformation "'+q((l=k.value)==null?void 0:l.name)+'"? This action cannot be undone. ',1)]}),_:1}),t(J,null,{default:a(()=>[t(y),t(p,{variant:"text",onClick:e[19]||(e[19]=l=>w.value=!1)},{default:a(()=>e[35]||(e[35]=[s(" Cancel ")])),_:1}),t(p,{color:"error",onClick:oe,loading:O.value},{default:a(()=>e[36]||(e[36]=[s(" Delete ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}};export{_e as default};
