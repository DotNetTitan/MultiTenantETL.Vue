import{u as we,r as u,o as xe,c as R,a as h,b as t,d as s,w as a,n as Ce,e as y,f as r,t as k,k as be,g as z,F as De,i as ke,h as H}from"./index-BvbqYwnB.js";const Pe={class:"d-flex align-center mb-4"},Ae={key:0,class:"text-center pa-4"},Te={key:0},Ee={__name:"PipelinesView",setup(Ne){const K=Ce(),M=we(),X=[{title:"Name",key:"name"},{title:"Source",key:"sourceName"},{title:"Destination",key:"destinationName"},{title:"Status",key:"status",width:"120px"},{title:"Last Run",key:"lastRunAt",width:"150px"},{title:"Scheduled",key:"isScheduled",width:"100px"},{title:"Actions",key:"actions",sortable:!1,width:"120px",align:"end"}],P=u(""),A=u("All"),E=u("name_asc"),Y=u([{title:"All Statuses",value:"All"},{title:"Idle",value:"Idle"},{title:"Running",value:"Running"},{title:"Failed",value:"Failed"}]),ee=u([{title:"Name (A-Z)",value:"name_asc"},{title:"Name (Z-A)",value:"name_desc"},{title:"Last Run (Newest)",value:"lastRun_desc"},{title:"Last Run (Oldest)",value:"lastRun_asc"}]),f=u([]),x=u([]),te=u(["Filter","Map","Join","Aggregate","Enrich","Custom"]),I=u(!1),F=u(!1),U=u(!1),p=u(!1),C=u(!1),_=u(!1),T=u(null),le=u(null),ae=u(null),o=u(ne()),c=u({name:"",type:"Filter",executionOrder:1,configuration:"{}"}),b=u(-1);function ne(){return{id:null,name:"",description:"",sourceId:null,destinationId:null,transformations:[],isScheduled:!1,schedule:{frequency:"Daily",time:"00:00",cronExpression:"0 0 * * *"}}}function oe(n){switch(n==null?void 0:n.toLowerCase()){case"completed":return"success";case"running":return"info";case"failed":return"error";case"idle":return"grey";default:return"grey"}}function ie(n){return n?new Date(n).toLocaleString():"-"}async function V(){try{if(I.value=!0,await new Promise(d=>setTimeout(d,500)),f.value=[{id:"1",name:"Sales Data ETL",description:"Extract sales data from SQL Server, transform, and load to data warehouse",sourceName:"SQL Server - Sales",destinationName:"Data Warehouse",status:"Idle",lastRunAt:new Date(Date.now()-2*60*60*1e3).toISOString(),isScheduled:!0},{id:"2",name:"Customer Import",description:"Import customer data from CSV files",sourceName:"SFTP - Customer Files",destinationName:"Customer Database",status:"Idle",lastRunAt:new Date(Date.now()-24*60*60*1e3).toISOString(),isScheduled:!0},{id:"3",name:"Product Sync",description:"Sync product data between systems",sourceName:"ERP API",destinationName:"E-commerce Platform",status:"Running",lastRunAt:new Date(Date.now()-10*60*1e3).toISOString(),isScheduled:!1},{id:"4",name:"Analytics Export",description:"Export analytics data to reporting system",sourceName:"Analytics DB",destinationName:"Reporting System",status:"Failed",lastRunAt:new Date(Date.now()-12*60*60*1e3).toISOString(),isScheduled:!0}],P.value){const d=P.value.toLowerCase();f.value=f.value.filter(i=>i.name.toLowerCase().includes(d)||i.description.toLowerCase().includes(d))}A.value!=="All"&&(f.value=f.value.filter(d=>d.status===A.value));const[n,e]=E.value.split("_");f.value.sort((d,i)=>{let v=d[n],m=i[n];return n==="lastRun"&&(v=d.lastRunAt?new Date(d.lastRunAt).getTime():0,m=i.lastRunAt?new Date(i.lastRunAt).getTime():0),e==="asc"?v>m?1:-1:v<m?1:-1})}catch(n){console.error("Error fetching pipelines:",n)}finally{I.value=!1}}async function Q(){try{await new Promise(n=>setTimeout(n,300)),x.value=[{id:"1",name:"SQL Server - Sales",type:"Database"},{id:"2",name:"SFTP - Customer Files",type:"File"},{id:"3",name:"ERP API",type:"API"},{id:"4",name:"Analytics DB",type:"Database"},{id:"5",name:"Data Warehouse",type:"Database"},{id:"6",name:"Customer Database",type:"Database"},{id:"7",name:"E-commerce Platform",type:"API"},{id:"8",name:"Reporting System",type:"API"}]}catch(n){console.error("Error fetching data sources:",n)}}function se(n){o.value={id:n.id,name:n.name,description:n.description,sourceId:x.value.find(e=>e.name===n.sourceName)||null,destinationId:x.value.find(e=>e.name===n.destinationName)||null,transformations:n.transformations||[],isScheduled:n.isScheduled,schedule:n.schedule||{frequency:"Daily",time:"00:00",cronExpression:"0 0 * * *"}},p.value=!0}function ue(n){T.value=n,C.value=!0}async function re(){try{U.value=!0,await new Promise(e=>setTimeout(e,1e3));const n=f.value.findIndex(e=>e.id===T.value.id);n!==-1&&f.value.splice(n,1),C.value=!1,T.value=null}catch(n){console.error("Error deleting pipeline:",n)}finally{U.value=!1}}function de(){c.value={name:"",type:"Filter",executionOrder:o.value.transformations.length+1,configuration:"{}"},b.value=-1,_.value=!0}function me(n){const e=o.value.transformations[n];c.value={...e},b.value=n,_.value=!0}function ce(n){o.value.transformations.splice(n,1),o.value.transformations.forEach((e,d)=>{e.executionOrder=d+1})}function ve(){b.value===-1?o.value.transformations.push({...c.value}):o.value.transformations[b.value]={...c.value},o.value.transformations.sort((n,e)=>n.executionOrder-e.executionOrder),_.value=!1}async function W(){try{F.value=!0,await new Promise(n=>setTimeout(n,1e3)),p.value=!1,await V()}catch(n){console.error("Error saving pipeline:",n)}finally{F.value=!1}}function fe(n){n.status="Running",n.lastRunAt=new Date().toISOString(),setTimeout(()=>{n.status=Math.random()>.2?"Completed":"Failed"},5e3)}function j(){p.value=!1,K.push("/data-sources?action=create")}return xe(async()=>{await Q(),await V(),M.$subscribe(()=>{M.currentTenantId&&(Q(),V())})}),(n,e)=>{const d=s("v-spacer"),i=s("v-btn"),v=s("v-text-field"),m=s("v-col"),S=s("v-select"),O=s("v-row"),pe=s("v-chip"),g=s("v-icon"),ye=s("v-data-table"),N=s("v-card-text"),D=s("v-card"),L=s("v-card-title"),J=s("v-textarea"),q=s("v-list-item"),Z=s("v-divider"),_e=s("v-list"),Ve=s("v-switch"),Se=s("v-expand-transition"),G=s("v-form"),$=s("v-card-actions"),B=s("v-dialog");return y(),R("div",null,[h("div",Pe,[e[23]||(e[23]=h("h1",{class:"text-h4 mr-4"},"Pipelines",-1)),t(d),t(i,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=l=>p.value=!0)},{default:a(()=>e[22]||(e[22]=[r(" Create Pipeline ")])),_:1})]),t(D,null,{default:a(()=>[t(N,null,{default:a(()=>[t(O,null,{default:a(()=>[t(m,{cols:"12",md:"4"},{default:a(()=>[t(v,{modelValue:P.value,"onUpdate:modelValue":[e[1]||(e[1]=l=>P.value=l),V],label:"Search Pipelines","prepend-inner-icon":"mdi-magnify",density:"compact","hide-details":"",class:"mb-4"},null,8,["modelValue"])]),_:1}),t(m,{cols:"12",md:"3"},{default:a(()=>[t(S,{modelValue:A.value,"onUpdate:modelValue":[e[2]||(e[2]=l=>A.value=l),V],label:"Status",items:Y.value,density:"compact","hide-details":"",class:"mb-4"},null,8,["modelValue","items"])]),_:1}),t(m,{cols:"12",md:"3"},{default:a(()=>[t(S,{modelValue:E.value,"onUpdate:modelValue":[e[3]||(e[3]=l=>E.value=l),V],label:"Sort By",items:ee.value,density:"compact","hide-details":"",class:"mb-4"},null,8,["modelValue","items"])]),_:1})]),_:1}),t(ye,{headers:X,items:f.value,loading:I.value,"items-per-page":10,class:"mt-2"},{"item.status":a(({item:l})=>[t(pe,{color:oe(l.status),"text-color":"white",size:"small"},{default:a(()=>[r(k(l.status),1)]),_:2},1032,["color"])]),"item.lastRunAt":a(({item:l})=>[r(k(l.lastRunAt?ie(l.lastRunAt):"Never"),1)]),"item.actions":a(({item:l})=>[t(i,{icon:"",variant:"text",size:"small",to:`/pipelines/${l.id}`,title:"View details"},{default:a(()=>[t(g,null,{default:a(()=>e[24]||(e[24]=[r("mdi-eye")])),_:1})]),_:2},1032,["to"]),t(i,{icon:"",variant:"text",size:"small",onClick:w=>se(l),title:"Edit pipeline"},{default:a(()=>[t(g,null,{default:a(()=>e[25]||(e[25]=[r("mdi-pencil")])),_:1})]),_:2},1032,["onClick"]),t(i,{icon:"",variant:"text",size:"small",color:"success",onClick:w=>fe(l),disabled:l.status==="Running",title:"Execute pipeline"},{default:a(()=>[t(g,null,{default:a(()=>e[26]||(e[26]=[r("mdi-play")])),_:1})]),_:2},1032,["onClick","disabled"]),t(i,{icon:"",variant:"text",size:"small",color:"error",onClick:w=>ue(l),title:"Delete pipeline"},{default:a(()=>[t(g,null,{default:a(()=>e[27]||(e[27]=[r("mdi-delete")])),_:1})]),_:2},1032,["onClick"])]),_:1},8,["items","loading"])]),_:1})]),_:1}),t(B,{modelValue:p.value,"onUpdate:modelValue":e[13]||(e[13]=l=>p.value=l),"max-width":"800px",persistent:""},{default:a(()=>[t(D,null,{default:a(()=>[t(L,null,{default:a(()=>[r(k(o.value.id?"Edit Pipeline":"Create Pipeline"),1)]),_:1}),t(N,null,{default:a(()=>[t(G,{ref_key:"form",ref:le,onSubmit:be(W,["prevent"])},{default:a(()=>[t(O,null,{default:a(()=>[t(m,{cols:"12"},{default:a(()=>[t(v,{modelValue:o.value.name,"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.name=l),label:"Pipeline Name",required:"",rules:[l=>!!l||"Name is required"]},null,8,["modelValue","rules"])]),_:1}),t(m,{cols:"12"},{default:a(()=>[t(J,{modelValue:o.value.description,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.description=l),label:"Description",rows:"2"},null,8,["modelValue"])]),_:1}),t(m,{cols:"12",md:"6"},{default:a(()=>[t(S,{modelValue:o.value.sourceId,"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.sourceId=l),label:"Source",items:x.value,"item-title":"name","item-value":"id",rules:[l=>!!l||"Source is required"],"return-object":""},{"prepend-item":a(()=>[t(q,{title:"Create New Source...","prepend-icon":"mdi-plus",onClick:j}),t(Z,{class:"mt-2"})]),_:1},8,["modelValue","items","rules"])]),_:1}),t(m,{cols:"12",md:"6"},{default:a(()=>[t(S,{modelValue:o.value.destinationId,"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.destinationId=l),label:"Destination",items:x.value,"item-title":"name","item-value":"id",rules:[l=>!!l||"Destination is required"],"return-object":""},{"prepend-item":a(()=>[t(q,{title:"Create New Destination...","prepend-icon":"mdi-plus",onClick:j}),t(Z,{class:"mt-2"})]),_:1},8,["modelValue","items","rules"])]),_:1}),t(m,{cols:"12"},{default:a(()=>[e[31]||(e[31]=h("div",{class:"text-subtitle-1 mb-2"},"Transformations",-1)),t(D,{variant:"outlined",class:"mb-4 pa-2"},{default:a(()=>[o.value.transformations.length===0?(y(),R("div",Ae," No transformations added yet ")):(y(),z(_e,{key:1},{default:a(()=>[(y(!0),R(De,null,ke(o.value.transformations,(l,w)=>(y(),z(q,{key:w,title:l.name,subtitle:`Type: ${l.type}`},{append:a(()=>[t(i,{icon:"",variant:"text",size:"small",onClick:ge=>me(w)},{default:a(()=>[t(g,null,{default:a(()=>e[28]||(e[28]=[r("mdi-pencil")])),_:1})]),_:2},1032,["onClick"]),t(i,{icon:"",variant:"text",size:"small",color:"error",onClick:ge=>ce(w)},{default:a(()=>[t(g,null,{default:a(()=>e[29]||(e[29]=[r("mdi-delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["title","subtitle"]))),128))]),_:1})),t(i,{block:"",variant:"tonal","prepend-icon":"mdi-plus",class:"mt-2",onClick:de},{default:a(()=>e[30]||(e[30]=[r(" Add Transformation ")])),_:1})]),_:1})]),_:1}),t(m,{cols:"12"},{default:a(()=>[t(Ve,{modelValue:o.value.isScheduled,"onUpdate:modelValue":e[8]||(e[8]=l=>o.value.isScheduled=l),label:"Schedule this pipeline","hide-details":"",class:"mb-2"},null,8,["modelValue"]),t(Se,null,{default:a(()=>[o.value.isScheduled?(y(),R("div",Te,[t(O,null,{default:a(()=>[t(m,{cols:"12",md:"6"},{default:a(()=>[t(S,{modelValue:o.value.schedule.frequency,"onUpdate:modelValue":e[9]||(e[9]=l=>o.value.schedule.frequency=l),label:"Frequency",items:["Daily","Weekly","Monthly","Custom"]},null,8,["modelValue"])]),_:1}),t(m,{cols:"12",md:"6"},{default:a(()=>[t(v,{modelValue:o.value.schedule.time,"onUpdate:modelValue":e[10]||(e[10]=l=>o.value.schedule.time=l),label:"Time",type:"time"},null,8,["modelValue"])]),_:1}),o.value.schedule.frequency==="Custom"?(y(),z(m,{key:0,cols:"12"},{default:a(()=>[t(v,{modelValue:o.value.schedule.cronExpression,"onUpdate:modelValue":e[11]||(e[11]=l=>o.value.schedule.cronExpression=l),label:"Cron Expression",hint:"e.g. 0 0 * * *","persistent-hint":""},null,8,["modelValue"])]),_:1})):H("",!0)]),_:1})])):H("",!0)]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1}),t($,null,{default:a(()=>[t(d),t(i,{variant:"text",onClick:e[12]||(e[12]=l=>p.value=!1)},{default:a(()=>e[32]||(e[32]=[r(" Cancel ")])),_:1}),t(i,{color:"primary",onClick:W,loading:F.value},{default:a(()=>e[33]||(e[33]=[r(" Save ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(B,{modelValue:C.value,"onUpdate:modelValue":e[15]||(e[15]=l=>C.value=l),"max-width":"400px"},{default:a(()=>[t(D,null,{default:a(()=>[t(L,{class:"text-h5"},{default:a(()=>e[34]||(e[34]=[r(" Delete Pipeline ")])),_:1}),t(N,null,{default:a(()=>{var l;return[r(' Are you sure you want to delete the pipeline "'+k((l=T.value)==null?void 0:l.name)+'"? This action cannot be undone. ',1)]}),_:1}),t($,null,{default:a(()=>[t(d),t(i,{variant:"text",onClick:e[14]||(e[14]=l=>C.value=!1)},{default:a(()=>e[35]||(e[35]=[r(" Cancel ")])),_:1}),t(i,{color:"error",onClick:re,loading:U.value},{default:a(()=>e[36]||(e[36]=[r(" Delete ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(B,{modelValue:_.value,"onUpdate:modelValue":e[21]||(e[21]=l=>_.value=l),"max-width":"600px"},{default:a(()=>[t(D,null,{default:a(()=>[t(L,null,{default:a(()=>[r(k(b.value===-1?"Add Transformation":"Edit Transformation"),1)]),_:1}),t(N,null,{default:a(()=>[t(G,{ref_key:"transformationForm",ref:ae},{default:a(()=>[t(v,{modelValue:c.value.name,"onUpdate:modelValue":e[16]||(e[16]=l=>c.value.name=l),label:"Name",rules:[l=>!!l||"Name is required"]},null,8,["modelValue","rules"]),t(S,{modelValue:c.value.type,"onUpdate:modelValue":e[17]||(e[17]=l=>c.value.type=l),label:"Type",items:te.value,rules:[l=>!!l||"Type is required"]},null,8,["modelValue","items","rules"]),t(v,{modelValue:c.value.executionOrder,"onUpdate:modelValue":e[18]||(e[18]=l=>c.value.executionOrder=l),label:"Execution Order",type:"number",min:"1"},null,8,["modelValue"]),t(J,{modelValue:c.value.configuration,"onUpdate:modelValue":e[19]||(e[19]=l=>c.value.configuration=l),label:"Configuration",rows:"5",hint:"Enter JSON configuration for the transformation","persistent-hint":""},null,8,["modelValue"])]),_:1},512)]),_:1}),t($,null,{default:a(()=>[t(d),t(i,{variant:"text",onClick:e[20]||(e[20]=l=>_.value=!1)},{default:a(()=>e[37]||(e[37]=[r(" Cancel ")])),_:1}),t(i,{color:"primary",onClick:ve},{default:a(()=>e[38]||(e[38]=[r(" Save ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}};export{Ee as default};
